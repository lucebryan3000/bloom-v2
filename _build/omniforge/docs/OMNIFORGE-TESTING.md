# OmniForge Testing & E2E Harness

Overview of the testing setup generated by OmniForge, including unit/integration (Vitest) and end-to-end (Playwright) scaffolds.

## Components
- **Vitest**: Unit/integration tests under `src/test/` (or stack-defined test folders). Configured via `vitest.config.ts` and `tsconfig.json` paths.
- **Testing Library + JSDOM**: For React component testing when enabled.
- **Playwright**: E2E tests under `e2e/` with `playwright.config.ts` (CI-friendly base URL, headed/headless options).

## Commands
- Run unit/integration tests: `pnpm test` or `pnpm vitest`
- Run Playwright E2E: `pnpm playwright test`
- Install test deps (if optional flags were off): enable `ENABLE_TEST_INFRA` and rerun the quality/testing phase or `pnpm add -D` the missing packages.

## CI Considerations
- Services: App and Postgres must be up for E2E hitting live endpoints; use Docker compose (`omni stack up`) or `DOCKER_EXEC_MODE=container` to run inside the app container.
- Base URL: Configure `PLAYWRIGHT_TEST_BASE_URL` (if required) or use the default from `playwright.config.ts` (often `http://localhost:3000`).
- Headless: Default is headless in CI; set `HEADLESS=false` locally for debugging.
- Artifacts: Playwright outputs traces/screenshots/videos (if enabled) under `playwright-report/` or configured output dirs; clean as needed.

## Directory Pointers
- Playwright tests: `e2e/`
- Vitest tests: `src/test/` (plus any feature-specific test dirs added by stack scripts)
- Configs: `playwright.config.ts`, `vitest.config.ts`, `tsconfig.json`

## Regenerating / Updating
- If test scaffolds are missing, ensure testing-related flags are enabled (`ENABLE_TEST_INFRA`, `ENABLE_PLAYWRIGHT` if present) and rerun the relevant phase (typically Extensions & Quality) with `--force`.
- To reset Playwright/Vitest configs to defaults, copy from `_build/omniforge/example-files/` if provided, or rerun bootstrap phases that seed them.

## Troubleshooting
- Missing deps: check `package.json` devDependencies for vitest, @testing-library/*, jsdom, playwright; add and rerun.
- DB-dependent tests fail: ensure Postgres is running and seeded; set env vars for test DB.
- Timeouts in CI: increase Playwright timeouts or ensure services are healthy before running tests.
- ESM/CJS issues: ensure `type` in `package.json` and `tsconfig` match the scaffold expectations (stack defaults use ESM with proper tsconfig paths).

## References
- Build pipeline: `_build/omniforge/docs/OMNIFORGE-BUILD.md`
- Docker behavior: `_build/omniforge/docs/OMNIFORGE-DOCKER.md`
- Flags: `_build/omniforge/docs/OMNIFORGE-FLAGS.md`
- Profiles: `_build/omniforge/docs/OMNIFORGE-PROFILES.md`
- Workflow: `_build/omniforge/docs/OMNIFORGE-WORKFLOW.md`
