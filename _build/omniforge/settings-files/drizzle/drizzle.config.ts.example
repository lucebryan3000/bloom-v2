// ==============================================================================
// drizzle.config.ts - Drizzle Kit Configuration Template
// ==============================================================================
//
// LOCATION: /drizzle.config.ts (project root)
//
// PURPOSE:
//   Configure Drizzle Kit for database schema management, migration generation,
//   and database introspection. This file tells drizzle-kit where to find your
//   schema and where to output migrations.
//
// USAGE:
//   1. Copy this file to drizzle.config.ts in your project root
//   2. Ensure DATABASE_URL is set in your .env.local file
//   3. Run migrations with: pnpm db:generate && pnpm db:migrate
//
// BOOTSTRAP INTEGRATION:
//   Bootstrap scripts can set initial values from omni.* config:
//   - DB_NAME, DB_USER, DB_PASSWORD -> DATABASE_URL construction
//   - POSTGRES_VERSION -> dialect version hints
//   After setup, this file is the authoritative source for Drizzle configuration.
//
// ==============================================================================

import type { Config } from 'drizzle-kit';
import * as dotenv from 'dotenv';

// Load environment variables from .env.local
dotenv.config({ path: '.env.local' });

// Validate DATABASE_URL is set
if (!process.env.DATABASE_URL) {
  throw new Error('DATABASE_URL environment variable is required');
}

/**
 * Drizzle Kit Configuration
 * @see https://orm.drizzle.team/kit-docs/config-reference
 */
export default {
  // ==========================================================================
  // SCHEMA CONFIGURATION
  // ==========================================================================

  // Path to your Drizzle schema file(s)
  schema: './src/db/schema.ts',

  // For multiple schema files, use an array:
  // schema: ['./src/db/schema/*.ts'],

  // ==========================================================================
  // OUTPUT CONFIGURATION
  // ==========================================================================

  // Directory for generated migration files (commit these to Git)
  out: './src/db/migrations',

  // ==========================================================================
  // DATABASE CONFIGURATION
  // ==========================================================================

  // Database dialect: postgresql, mysql, sqlite
  dialect: 'postgresql',

  // Database connection credentials
  dbCredentials: {
    url: process.env.DATABASE_URL,
  },

  // Alternative: Individual credentials (if not using connection URL)
  // dbCredentials: {
  //   host: process.env.DB_HOST || 'localhost',
  //   port: parseInt(process.env.DB_PORT || '5432'),
  //   user: process.env.DB_USER,
  //   password: process.env.DB_PASSWORD,
  //   database: process.env.DB_NAME,
  //   ssl: process.env.DB_SSL === 'true',
  // },

  // ==========================================================================
  // MIGRATION OPTIONS
  // ==========================================================================

  // Enable strict mode for safer migrations
  strict: true,

  // Enable verbose logging during migration generation
  verbose: true,

  // Breakpoints in migrations (allows partial rollback)
  // breakpoints: true,

  // ==========================================================================
  // INTROSPECTION OPTIONS (for existing databases)
  // ==========================================================================

  // Tables to include (empty = all tables)
  // tablesFilter: ['users', 'posts', 'comments'],

  // Schema to use (PostgreSQL)
  // schemaFilter: ['public'],

} satisfies Config;

// ==============================================================================
// PACKAGE.JSON SCRIPTS (add these to your package.json)
// ==============================================================================
// "scripts": {
//   "db:generate": "drizzle-kit generate",
//   "db:migrate": "drizzle-kit migrate",
//   "db:push": "drizzle-kit push",
//   "db:studio": "drizzle-kit studio",
//   "db:drop": "drizzle-kit drop"
// }
// ==============================================================================
