# ==============================================================================
# AGENTS.md - AI Agent Instructions Template
# ==============================================================================
#
# LOCATION: /AGENTS.md (project root)
#
# PURPOSE:
#   Provide persistent instructions and project context to AI coding agents
#   (Codex, Copilot, Claude, etc.). This file defines the tech stack,
#   coding standards, and workflow constraints agents should follow.
#
# USAGE:
#   1. Copy this file to AGENTS.md in your project root
#   2. Customize sections to match your project's tech stack
#   3. Initial values can reference omni.settings.sh for tech versions
#   4. After setup, this file is the authoritative source for agent instructions
#
# BOOTSTRAP INTEGRATION:
#   Bootstrap scripts can populate version numbers from omni.settings.sh:
#   - NODE_VERSION, NEXT_VERSION, POSTGRES_VERSION -> Stack versions
#   - ENABLE_* flags -> Feature availability
#   After setup, this file is the authoritative source for AI agent behavior.
#
# ==============================================================================

# Project Agent Instructions

## 1. Technology Stack

### Frontend
- **Framework:** Next.js 15 (App Router)
- **UI Library:** React 19 (Server Components emphasis)
- **Styling:** Tailwind CSS with shadcn/ui components
- **State Management:** Zustand (client), Server Actions (mutations)

### Backend
- **Database:** PostgreSQL v16.x
- **ORM:** Drizzle ORM (TypeScript-first)
- **Background Jobs:** pg-boss
- **Authentication:** Auth.js v5

### Development
- **Package Manager:** pnpm v9.x
- **Language:** TypeScript (strict mode)
- **Testing:** Vitest (unit), Playwright (E2E)
- **Quality:** ESLint, Prettier

### Infrastructure
- **Containerization:** Docker with multi-stage builds
- **CI/CD:** GitHub Actions (or specify your CI)

## 2. Agent Workflow Instructions

### Code Generation Rules

1. **TypeScript First**
   - All new code must be TypeScript with strict type checking
   - Avoid `any` type; use proper generics or `unknown` when needed
   - Export types alongside functions/components

2. **Next.js Conventions**
   - Default to **Server Components** (async functions)
   - Only add `"use client"` directive when using client hooks (`useState`, `useEffect`, etc.)
   - Use Server Actions for data mutations
   - Follow App Router file conventions (`page.tsx`, `layout.tsx`, `loading.tsx`)

3. **Database Operations**
   - All database access must go through Drizzle ORM via `src/db/`
   - Verify changes align with `src/db/schema.ts` definitions
   - Never modify files in `src/db/migrations/` directly

4. **Package Management**
   - Always use `pnpm` for package operations
   - Check `package.json` before suggesting new dependencies
   - Prefer existing utilities over adding new packages

### Before Making Changes

1. **Verify Schema Compatibility**
   - Check `src/db/schema.ts` before database-related changes
   - Ensure new fields/tables follow existing naming conventions

2. **Check Existing Patterns**
   - Look for similar implementations in the codebase
   - Follow established patterns for consistency

3. **Consider Side Effects**
   - Think about how changes affect related components
   - Check for breaking changes in shared utilities

## 3. Directory Structure

```
src/
├── app/                    # Next.js App Router pages
│   ├── (auth)/            # Auth-related routes (grouped)
│   ├── api/               # API routes
│   └── layout.tsx         # Root layout
├── components/            # React components
│   ├── ui/               # shadcn/ui primitives
│   └── features/         # Feature-specific components
├── db/                    # Database layer
│   ├── schema.ts         # Drizzle schema definitions
│   ├── migrations/       # Generated migrations (DO NOT EDIT)
│   └── index.ts          # Database client export
├── lib/                   # Shared utilities
│   ├── auth/             # Auth configuration
│   └── utils/            # Helper functions
├── hooks/                 # Custom React hooks
├── stores/               # Zustand stores
└── types/                # TypeScript type definitions
```

## 4. Exclusions

### Never Search or Modify
- `.next/` - Next.js build output
- `node_modules/` - Dependencies
- `src/db/migrations/*.sql` - Generated migration files
- `.env*` - Environment files with secrets

### Read-Only Reference
- `pnpm-lock.yaml` - Lockfile (don't suggest changes)
- `drizzle.config.ts` - ORM config (rarely needs changes)

## 5. Common Tasks

### Adding a New Page
1. Create file in `src/app/[route]/page.tsx`
2. Default to Server Component
3. Add loading state in `loading.tsx` if data fetching
4. Update navigation if needed

### Adding a Database Table
1. Define schema in `src/db/schema.ts`
2. Run `pnpm db:generate` to create migration
3. Run `pnpm db:migrate` to apply
4. Add types to `src/types/` if needed

### Creating a New Component
1. Place in appropriate `src/components/` subdirectory
2. Export from index file if shared
3. Add types inline or in `src/types/`
4. Follow existing component patterns

## 6. Code Style Quick Reference

```typescript
// Server Component (default)
export default async function MyPage() {
  const data = await fetchData();
  return <div>{data}</div>;
}

// Client Component (only when needed)
'use client';
export function InteractiveWidget() {
  const [state, setState] = useState(false);
  return <button onClick={() => setState(!state)}>Toggle</button>;
}

// Server Action
'use server';
export async function createItem(formData: FormData) {
  const name = formData.get('name');
  await db.insert(items).values({ name });
  revalidatePath('/items');
}
```

# ==============================================================================
# END OF AGENT INSTRUCTIONS
# ==============================================================================
